rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Only allow creating concierge requests with specific fields.
    match /conciergeRequests/{docId} {
      allow create: if
        request.auth == null &&
        request.resource.data.keys().hasOnly(["email", "createdAt", "source"]) &&
        request.resource.data.email is string &&
        request.resource.data.email.size() > 3 && request.resource.data.email.size() <= 254 &&
        request.resource.data.email.matches('^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$') &&
        request.resource.data.createdAt is timestamp &&
        request.resource.data.source == 'web-app';

      // No reads/updates/deletes from clients
      allow read, update, delete: if false;
    }
  }
}


